# Configuration using ALL mmBERT-32K merged models (32K context, YaRN RoPE)
# All classifiers now use the merged models uploaded to HuggingFace

# Response API Configuration
response_api:
  enabled: true
  store_backend: "memory"
  ttl_seconds: 86400
  max_responses: 1000

# Router Replay Configuration
router_replay:
  store_backend: "memory"
  ttl_seconds: 2592000
  async_writes: true

# Semantic Cache Configuration (disabled - no embedding model)
semantic_cache:
  enabled: false
  backend_type: "memory"
  similarity_threshold: 0.8
  max_entries: 1000
  ttl_seconds: 3600
  eviction_policy: "fifo"

# Embedding Models Configuration (disabled - focus on classifiers)
embedding_models:
  use_cpu: true

# Tools Configuration
tools:
  enabled: false  # Disable tools since no embedding model

# ============================================================================
# mmBERT-32K Classifiers Configuration (ALL MERGED MODELS)
# All classifiers use the 32K context, YaRN RoPE scaled merged models
# ============================================================================

# Prompt Guard (Jailbreak Detection) - mmBERT-32K MERGED
prompt_guard:
  enabled: true
  model_id: "models/mmbert32k-jailbreak-detector-merged"
  threshold: 0.7
  use_cpu: true
  use_modernbert: false
  use_mmbert_32k: true
  jailbreak_mapping_path: "models/mmbert32k-jailbreak-detector-merged/jailbreak_type_mapping.json"

# Classifier Configuration - mmBERT-32K Intent Classifier MERGED
classifier:
  category_model:
    model_id: "models/mmbert32k-intent-classifier-merged"
    threshold: 0.3
    use_cpu: true
    use_modernbert: false
    use_mmbert_32k: true
    category_mapping_path: "models/mmbert32k-intent-classifier-merged/category_mapping.json"
  pii_model:
    model_id: "models/mmbert32k-pii-detector-merged"
    threshold: 0.7
    use_cpu: true
    use_mmbert_32k: true
    pii_mapping_path: "models/mmbert32k-pii-detector-merged/label_mapping.json"

# Feedback Detector - mmBERT-32K MERGED
feedback_detector:
  enabled: true
  model_id: "models/mmbert32k-feedback-detector-merged"
  threshold: 0.7
  use_cpu: true
  use_modernbert: false
  use_mmbert_32k: true

# Hallucination Mitigation - mmBERT-32K Fact-Check MERGED
hallucination_mitigation:
  enabled: true
  fact_check_model:
    model_id: "models/mmbert32k-factcheck-classifier-merged"
    threshold: 0.3
    use_cpu: true
    use_mmbert_32k: true
  hallucination_model:
    model_id: "models/mom-halugate-detector"  # Keep existing (no 32K version)
    threshold: 0.8
    use_cpu: true
    min_span_length: 2
    min_span_confidence: 0.6
    context_window_size: 50
    enable_nli_filtering: true
    nli_entailment_threshold: 0.75
  nli_model:
    model_id: "models/mom-halugate-explainer"
    threshold: 0.7
    use_cpu: true

# ============================================================================
# vLLM Endpoints Configuration
# ============================================================================
vllm_endpoints:
  - name: "ollama"
    address: "127.0.0.1"
    port: 11434
    weight: 1

model_config:
  "qwen2.5:3b":
    reasoning_family: "qwen3"
    preferred_endpoints: ["ollama"]

# Categories
categories:
  - name: business
    description: "Business and management related queries"
    mmlu_categories: ["business"]
  - name: law
    description: "Legal questions and law-related topics"
    mmlu_categories: ["law"]
  - name: psychology
    description: "Psychology and mental health topics"
    mmlu_categories: ["psychology"]
  - name: biology
    description: "Biology and life sciences questions"
    mmlu_categories: ["biology"]
  - name: chemistry
    description: "Chemistry and chemical sciences questions"
    mmlu_categories: ["chemistry"]
  - name: history
    description: "Historical questions and cultural topics"
    mmlu_categories: ["history"]
  - name: other
    description: "General knowledge and miscellaneous topics"
    mmlu_categories: ["other"]
  - name: health
    description: "Health and medical information queries"
    mmlu_categories: ["health"]
  - name: physics
    description: "Physics and physical sciences questions"
    mmlu_categories: ["physics"]
  - name: computer_science
    description: "Computer science and software engineering"
    mmlu_categories: ["computer_science"]
  - name: math
    description: "Mathematics and statistical questions"
    mmlu_categories: ["math"]
  - name: philosophy
    description: "Philosophy and ethical questions"
    mmlu_categories: ["philosophy"]
  - name: economics
    description: "Economics and financial analysis"
    mmlu_categories: ["economics"]
  - name: engineering
    description: "Engineering and technical design"
    mmlu_categories: ["engineering"]

# Fact Check Rules - defines signal names for fact-check classification
fact_check_rules:
  - name: "needs_fact_check"
    description: "Query contains factual claims that should be verified"
  - name: "no_fact_check_needed"
    description: "Query is creative, subjective, or doesn't need fact verification"

# User Feedback Rules - defines signal names for user feedback classification
user_feedback_rules:
  - name: "satisfied"
    description: "User is satisfied with the response"
  - name: "need_clarification"
    description: "User needs more clarification or explanation"
  - name: "wrong_answer"
    description: "User indicates the answer is incorrect"
  - name: "want_different"
    description: "User wants a different approach or alternative"

# Routing decisions
decisions:
  # Fact check decision - triggers when query needs fact verification
  - name: "fact_check_needed"
    description: "Route queries that need fact verification"
    priority: 90
    rules:
      operator: "OR"
      conditions:
        - type: "fact_check"
          name: "needs_fact_check"
    modelRefs:
      - model: "qwen2.5:3b"
        use_reasoning: true
        weight: 100

  # User feedback decisions
  - name: "handle_clarification"
    description: "User needs clarification"
    priority: 85
    rules:
      operator: "OR"
      conditions:
        - type: "user_feedback"
          name: "need_clarification"
    modelRefs:
      - model: "qwen2.5:3b"
        use_reasoning: false
        weight: 100

  - name: "handle_wrong_answer"
    description: "User indicates wrong answer"
    priority: 85
    rules:
      operator: "OR"
      conditions:
        - type: "user_feedback"
          name: "wrong_answer"
    modelRefs:
      - model: "qwen2.5:3b"
        use_reasoning: true
        weight: 100

  - name: "handle_want_different"
    description: "User wants different approach"
    priority: 85
    rules:
      operator: "OR"
      conditions:
        - type: "user_feedback"
          name: "want_different"
    modelRefs:
      - model: "qwen2.5:3b"
        use_reasoning: false
        weight: 100

  # Default routing
  - name: "default"
    description: "Default routing decision"
    priority: 100
    rules:
      operator: "OR"
      conditions:
        - type: "domain"
          name: "other"
    modelRefs:
      - model: "qwen2.5:3b"
        use_reasoning: false
        weight: 100
